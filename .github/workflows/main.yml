–∏–º—è : –°–±–æ—Ä –ø—Ä–æ–∫—Å–∏ 

–Ω–∞ : 
  —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ : 
- –∫—Ä–æ–Ω : ' 0 */2 * * * ' 
  workflow_dispatch : ~ 

–≤–∞–∫–∞–Ω—Å–∏–∏ : 
  —Å—Ç—Ä–æ–∏—Ç—å : 
    –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è : ubuntu-latest 
    –º–∏–Ω—É—Ç —Ç–∞–π–º–∞—É—Ç–∞ : 60 
    —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è : 
      —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ : –Ω–∞–ø–∏—Å–∞—Ç—å 

    —à–∞–≥–∏ : 
- –∏–º—è : –ö–æ–¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ 
        –∏—Å–ø–æ–ª—å–∑—É–µ—Ç : actions/checkout@v4 

- –∏–º—è : –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ 
        –≤—ã–ø–æ–ª–Ω–∏—Ç—å : | 
sudo apt-get update 
sudo apt-get install -y jq python3 python3-pip netcat-openbsd 
pip3 install pyyaml ‚Äã‚Äã-q 
- –ù–∞–∑–≤–∞–Ω–∏–µ : –°–æ–±–∏—Ä–∞–π—Ç–µ –∏ —Ç—â–∞—Ç–µ–ª—å–Ω–æ –æ—á–∏—â–∞–π—Ç–µ Vless 
        –≤—ã–ø–æ–ª–Ω–∏—Ç—å : | 
 –°–µ–º—å 
          echo "–ù–∞—á–∞–ª–æ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ $(–¥–∞—Ç–∞)" 
SOURCE_FILE="VlessLinks.txt" 
          –µ—Å–ª–∏ [ ! -f "$SOURCE_FILE" ]; —Ç–æ–≥–¥–∞ 
            echo "–§–∞–π–ª VlessLinks.txt –Ω–µ –Ω–∞–π–¥–µ–Ω" 
            –≤—ã—Ö–æ–¥ 1 
—Ñ–∏ 
rm -f all_proxies.yaml temp.txt 
echo "proxies:" > all_proxies.yaml 
          –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ=0 
total_urls=$(grep -v '^#' "$SOURCE_FILE" | grep -v '^$' | wc -l) 
          echo "–ù–∞–π–¥–µ–Ω–æ $total_urls URL-–∞–¥—Ä–µ—Å–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏" 
while IFS= read -r url || [ -n "$url" ]; do 
clean_url=$(echo "$url" | tr -d '\r' | tr -d '"' | xargs) 
[[ -z "$clean_url" || "$clean_url" == \#* ]] && continue 
            
count=$((count + 1)) 
echo "[$count/$total_urls] –û–±—Ä–∞–±–æ—Ç–∫–∞: $clean_url" 
            
curl -fsSL --max-time 10 --max-filesize 1M "$clean_url" >> temp.txt 2>/dev/null || { 
              echo " ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ —Ä–∞–∑–º–µ—Ä —Å–ª–∏—à–∫–æ–º –≤–µ–ª–∏–∫" 
              –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å 
} 
echo "" >> temp.txt 
echo " ‚úÖ –ì–æ—Ç–æ–≤–æ" 
–≥–æ—Ç–æ–≤–æ < "$SOURCE_FILE" 
          echo "–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö..." 
sed -i 's/vless:/\nvless:/g' temp.txt 
grep -oE 'vless://[^[:space:]]+' temp.txt \ 
| grep -v "%25" \ 
| grep -E 'vless://[^@]+@[^:]+:[0-9]+' \ 
| grep -v "127.0.0.1" \ 
| grep -v "üîí" \ 
| grep -v "tls" \ 
| grep -v " " \ 
| awk 'length($0) > 40 && length($0) < 1200' \ 
| sort -u \ 
| head -n 10000 \ 
| sed 's/^/ - /' >> all_proxies.yaml || –∏—Å—Ç–∏–Ω–Ω—ã–π 
rm -f temp.txt 
          
          echo "–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω –≤ $(–¥–∞—Ç–∞)" 
          
total_proxies=$(grep -c '^-' all_proxies.yaml 2>/dev/null) || –∏—Å—Ç–∏–Ω–Ω—ã–π 
total_proxies=${total_proxies:-0} 
          echo "–ù–∞–π–¥–µ–Ω–æ $total_proxies –ø—Ä–æ–∫—Å–∏" 
- –∏–º—è : –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∏–Ω–≥–∞ - —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª ping.yaml 
        –≤—ã–ø–æ–ª–Ω–∏—Ç—å : | 
 –°–µ–º—å 
          echo "–ù–∞—á–∞–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–≤—è–∑–∏ (PING) –≤ $(–¥–∞—Ç–∞)" 
          
sudo apt-get update 
sudo apt-get install -y netcat-openbsd 
          
echo "proxies:" > ping.yaml 
> /tmp/ping_servers.txt 
> /tmp/ping_ports.txt 
> /tmp/ping_lines.txt 
> /tmp/ping_passed.txt 
          
          –≤—Å–µ–≥–æ=0 
          
          while IFS= read -r line || [ -n "$line" ]; do
[[ "$line" == "proxies:" ]] && continue 
[[ -z "$line" ]] && continue 
            
url="${line# - }" 
            
server_port=$(echo "$url" | sed -n 's#vless://[^@]*@\([^?#]*\).*#\1#p') 
server=$(echo "$server_port" | cut -d: -f1) 
port=$(echo "$server_port" | cut -d: -f2 | grep -E '^[0-9]+$' || true) 
            
            –µ—Å–ª–∏ [ -z "$server" ] || [ -z "$port" ]; —Ç–æ–≥–¥–∞ 
              –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å 
—Ñ–∏ 
            
total=$((total + 1)) 
            
echo "$server" >> /tmp/ping_servers.txt 
echo "$port" >> /tmp/ping_ports.txt 
echo "$line" >> /tmp/ping_lines.txt 
            
–≥–æ—Ç–æ–≤–æ < all_proxies.yaml 
          
          echo "–í—Å–µ–≥–æ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è –ø–∏–Ω–≥–∞: $total" 
          echo "–ó–∞–ø—É—Å–∫ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –ø–∏–Ω–≥–∞ (–ø–æ 50 –∑–∞ —Ä–∞–∑)..." 
          
ping_proxy() { 
local idx=$1 
local server=$(sed -n "${idx}p" /tmp/ping_servers.txt) 
            –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ—Ä—Ç=$(sed -n "${idx}p" /tmp/ping_ports.txt) 
local line=$(sed -n "${idx}p" /tmp/ping_lines.txt) 
            
if timeout 2 bash -c "echo >/dev/tcp/$server/$port" 2>/dev/null; then 
echo "$line" >> /tmp/ping_passed.txt 
echo "‚úÖ $server:$port - alive" 
            –µ—â–µ 
echo "‚ùå $server:$port - dead" 
—Ñ–∏ 
} 
export -f ping_proxy 
          
seq 1 $total | xargs -P 50 -I {} bash -c 'ping_proxy "$@"' _ {} 
          
          –µ—Å–ª–∏ [ -f /tmp/ping_passed.txt ]; —Ç–æ–≥–¥–∞ 
sort -u /tmp/ping_passed.txt >> ping.yaml 
—Ñ–∏ 
          
passed=$(grep -c '^-' ping.yaml 2>/dev/null) || –∏—Å—Ç–∏–Ω–Ω—ã–π 
passed=${passed:-0} 
          
echo "" 
          echo "=== –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ê PING ===" 
          echo "–í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: $total" 
          echo "‚úÖ –ü–∏–Ω–≥ –ø—Ä–æ–π–¥–µ–Ω: $passed" 
          echo "‚ùå –ù–µ—É–¥–∞—á–Ω—ã–π –ø–∏–Ω–≥: $((–≤—Å–µ–≥–æ - –ø—Ä–æ–π–¥–µ–Ω–æ))" 
          
rm -f /tmp/ping_servers.txt /tmp/ping_ports.txt /tmp/ping_lines.txt /tmp/ping_passed.txt 
- –∏–º—è : –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ —Å –ø–æ–º–æ—â—å—é Xray - —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ traffic.yaml 
        –≤—ã–ø–æ–ª–Ω–∏—Ç—å : | 
 –°–µ–º—å 
          echo "–ù–∞—á–∞–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ —Å –ø–æ–º–æ—â—å—é Xray –≤ $(–¥–∞—Ç–∞)" 
          
wget -q https://github.com/XTLS/Xray-core/releases/latest/download/Xray-linux-64.zip 
unzip -q Xray-linux-64.zip -d xray/ 
chmod +x xray/xray 
          
          ./xray/xray version || echo "‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ Xray –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞" 
          
          # Python-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥–∞ Xray 
echo 'import json, sys, urllib.parse' > /tmp/gen_xray_config.py 
echo 'url = sys.argv[1]' >> /tmp/gen_xray_config.py 
echo 'local_port = int(sys.argv[2])' >> /tmp/gen_xray_config.py 
echo 'try:' >> /tmp/gen_xray_config.py 
echo ' parsed = urllib.parse.urlparse(url.replace("vless://", "http://"))' >> /tmp/gen_xray_config.py 
echo ' auth, server_port = parsed.netloc.split("@", 1)' >> /tmp/gen_xray_config.py 
echo ' server, port = server_port.rsplit(":", 1)' >> /tmp/gen_xray_config.py 
echo ' uuid = urllib.parse.unquote(auth)' >> /tmp/gen_xray_config.py 
echo ' params = dict(urllib.parse.parse_qsl(parsed.query))' >> /tmp/gen_xray_config.py 
          echo ' network = params.get("type", "tcp")' >> /tmp/gen_xray_config.py
          echo ' security = params.get("security", "none")' >> /tmp/gen_xray_config.py
          echo ' sni = params.get("sni", "")' >> /tmp/gen_xray_config.py
          echo ' if not sni and security in ["tls", "reality"]: sni = server' >> /tmp/gen_xray_config.py
          echo ' flow = params.get("flow", "")' >> /tmp/gen_xray_config.py
          echo ' host = params.get("host", "")' >> /tmp/gen_xray_config.py
          echo ' path = params.get("path", "")' >> /tmp/gen_xray_config.py
          echo ' pbk = params.get("pbk", "")' >> /tmp/gen_xray_config.py
          echo ' sid = params.get("sid", params.get("shortId", ""))' >> /tmp/gen_xray_config.py
          echo ' fp = params.get("fp", "chrome")' >> /tmp/gen_xray_config.py
          echo ' alpn = params.get("alpn", "")' >> /tmp/gen_xray_config.py
echo ' user = {"id": uuid, "encryption": "none"}' >> /tmp/gen_xray_config.py 
echo ' if flow: user["flow"] = flow' >> /tmp/gen_xray_config.py 
echo ' outbound_settings = {"vnext": [{"address": server, "port": int(port), "users": [user]}]}' >> /tmp/gen_xray_config.py 
echo ' stream_settings = {"network": network, "security": security}' >> /tmp/gen_xray_config.py 
echo ' if security == "tls":' >> /tmp/gen_xray_config.py 
echo ' tls_settings = {"serverName": sni, "allowInsecure": True, "fingerprint": fp}' >> /tmp/gen_xray_config.py 
echo ' if alpn: tls_settings["alpn"] = [a.strip() for a in alpn.split(",")]' >> /tmp/gen_xray_config.py 
echo ' stream_settings["tlsSettings"] = tls_settings' >> /tmp/gen_xray_config.py 
echo ' elif security == "reality":' >> /tmp/gen_xray_config.py 
echo ' reality_settings = {"serverName": sni, "allowInsecure": True, "fingerprint": fp}' >> /tmp/gen_xray_config.py 
echo ' if pbk: reality_settings["publicKey"] = pbk' >> /tmp/gen_xray_config.py 
echo ' if sid: reality_settings["shortId"] = sid' >> /tmp/gen_xray_config.py 
          echo ' stream_settings["realitySettings"] = reality_settings' >> /tmp/gen_xray_config.py
          echo ' if network == "ws" and (path or host):' >> /tmp/gen_xray_config.py
          echo ' ws_settings = {}' >> /tmp/gen_xray_config.py
          echo ' if path: ws_settings["path"] = path' >> /tmp/gen_xray_config.py
          echo ' if host: ws_settings["headers"] = {"Host": host}' >> /tmp/gen_xray_config.py
          echo ' stream_settings["wsSettings"] = ws_settings' >> /tmp/gen_xray_config.py
          echo ' elif network == "grpc":' >> /tmp/gen_xray_config.py
          echo ' grpc_settings = {}' >> /tmp/gen_xray_config.py
          echo ' if params.get("serviceName"): grpc_settings["serviceName"] = params.get("serviceName")' >> /tmp/gen_xray_config.py
          echo ' if params.get("authority"): grpc_settings["authority"] = params.get("authority")' >> /tmp/gen_xray_config.py
          echo ' stream_settings["grpcSettings"] = grpc_settings' >> /tmp/gen_xray_config.py
          echo ' config = {"log": {"loglevel": "warning"}, "inbounds": [{"port": local_port, "protocol": "socks", "settings": {"auth": "noauth", "udp": True}}], "outbounds": [{"tag": "proxy", "protocol": "vless", "settings": outbound_settings, "streamSettings": stream_settings}]}' >> /tmp/gen_xray_config.py
          echo ' print(json.dumps(config, indent=2))' >> /tmp/gen_xray_config.py
          echo 'except Exception as e:' >> /tmp/gen_xray_config.py
          echo ' print(json.dumps({"error": str(e)}), file=sys.stderr)' >> /tmp/gen_xray_config.py
          echo ' sys.exit(1)' >> /tmp/gen_xray_config.py
          
          echo "proxies:" > traff.yaml
          mkdir -p /tmp/xray_results
          rm -f /tmp/xray_results/*
          mkdir -p /tmp/xray_logs
          rm -f /tmp/xray_logs/*
          > /tmp/xray_queue.txt
          
          –≤—Å–µ–≥–æ=0
          valid_configs=0
          MAX_DEBUG=100
          
          while IFS= read -r line || [ -n "$line" ]; do
            [[ "$line" == "proxies:" ]] && continue
            [[ -z "$line" ]] && continue
            
            url="${line# - }"
            total=$((total + 1))
            
            –µ—Å–ª–∏ [[ $total -gt $MAX_DEBUG ]] && [[ $valid_configs -ge 20 ]]; —Ç–æ–≥–¥–∞
              –ø–µ—Ä–µ—Ä—ã–≤
            —Ñ–∏
            
            local_port=$((10000 + total))
            config_file="/tmp/xray_config_${total}.json"
            
            python3 /tmp/gen_xray_config.py "$url" "$local_port" > "$config_file" 2>/tmp/xray_logs/py_err_${total}.txt
            
            if ! jq -e '.' "$config_file" >/dev/null 2>&1; then
              echo "‚ö†Ô∏è –ü—Ä–æ–∫—Å–∏ #$total: –ù–µ–≤–µ—Ä–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è JSON" >&2
              cat "$config_file" >&2
              –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å
            —Ñ–∏
            
            valid_configs=$((valid_configs + 1))
            echo "$total|$local_port|$config_file|$url" >> /tmp/xray_queue.txt
            
          –≥–æ—Ç–æ–≤–æ < ping.yaml
          
          echo ""
          echo "üìã –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ $valid_configs –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–∏–∑ $total total)"
          echo "üîÑ –ó–∞–ø—É—Å–∫ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ —Ä–µ–Ω—Ç–≥–µ–Ω–æ–≤—Å–∫–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è (–ø–æ 5 –∑–∞ —Ä–∞–∑)..."
          echo ""
          
          > /tmp/xray_results/http_codes.txt
          
          test_xray_proxy() {
            –ª–æ–∫–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç="$1"
            local idx=$(echo "$item" | cut -d'|' -f1)
            local local_port=$(echo "$item" | cut -d'|' -f2)
            local config_file=$(echo "$item" | cut -d'|' -f3)
            local url=$(echo "$item" | cut -d'|' -f4-)
            
            local log_file="/tmp/xray_logs/xray_${idx}.log"
            local result_file="/tmp/xray_results/result_${idx}.txt"
            
            echo "üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏ #$idx..."
            
            ./xray/xray -config "$config_file" > "$log_file" 2>&1 &
            XRAY_PID=$!
            
            local port_ready=0
            for i in {1..30}; do
              if ! kill -0 $XRAY_PID 2>/dev/null; then
                echo " ‚ùå –ü—Ä–æ—Ü–µ—Å—Å —Ä–µ–Ω—Ç–≥–µ–Ω–æ–≤—Å–∫–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π" >&2
                –ø–µ—Ä–µ—Ä—ã–≤
              —Ñ–∏
              if nc -z 127.0.0.1 "$local_port" 2>/dev/null; then
                port_ready=1
                –ø–µ—Ä–µ—Ä—ã–≤
              —Ñ–∏
              —Å–æ–Ω 0.2
            —Å–¥–µ–ª–∞–Ω–Ω—ã–π
            
            –µ—Å–ª–∏ [[ $port_ready -eq 1 ]]; —Ç–æ–≥–¥–∞
              echo " ‚úì –ü–æ—Ä—Ç —Ä–µ–Ω—Ç–≥–µ–Ω–æ–≤—Å–∫–æ–≥–æ –¥–∞—Ç—á–∏–∫–∞ –æ—Ç–∫—Ä—ã—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ..."
              
              http_code=$(curl -s -o /dev/null -w "%{http_code}" \
                --socks5-hostname 127.0.0.1:"$local_port" \
                --connect-timeout 5 --max-time 10 \
                "http://www.gstatic.com/generate_204" 2>/dev/null) || http_code="000"
              
              echo "$http_code" >> /tmp/xray_results/http_codes.txt
              echo " üì° HTTP-–∫–æ–¥: $http_code"
              
              –µ—Å–ª–∏ [[ "$http_code" == "204" ]]; —Ç–æ–≥–¥–∞
                echo "$url" >> "$result_file"
                echo " ‚úÖ –ü–†–û–ô–î–ï–ù–û"
              –µ—â–µ
                echo " ‚ùå –°–ë–û–ô (HTTP $http_code)"
                –µ—Å–ª–∏ [[ "$http_code" != "000" ]]; —Ç–æ–≥–¥–∞
                  echo " üìÑ –ñ—É—Ä–Ω–∞–ª —Ä–µ–Ω—Ç–≥–µ–Ω–æ–≤—Å–∫–∏—Ö —Å–Ω–∏–º–∫–æ–≤:"
                  tail -5 "$log_file" | sed 's/^/ /' >&2
                —Ñ–∏
              —Ñ–∏
            –µ—â–µ
              echo " ‚ùå –ü–æ—Ä—Ç –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–ª—Å—è"
              echo " üìÑ –ñ—É—Ä–Ω–∞–ª —Ä–µ–Ω—Ç–≥–µ–Ω–æ–≤—Å–∫–∏—Ö —Å–Ω–∏–º–∫–æ–≤:"
              cat "$log_file" | sed 's/^/ /' >&2
            —Ñ–∏
            
            kill $XRAY_PID 2>/dev/null || true
            wait $XRAY_PID 2>/dev/null || true
            rm -f "$config_file" "$log_file"
            
            echo ""
          }
          export -f test_xray_proxy
          
          cat /tmp/xray_queue.txt | xargs -P 5 -I {} bash -c 'test_xray_proxy "{}"'
          
          –µ—Å–ª–∏ [ -d /tmp/xray_results ]; —Ç–æ–≥–¥–∞
            cat /tmp/xray_results/result_*.txt 2>/dev/null | grep -v '^$' >> traff.yaml || –∏—Å—Ç–∏–Ω–Ω—ã–π
          —Ñ–∏
          
          pass=$(grep -c '^-' traff.yaml 2>/dev/null) || –∏—Å—Ç–∏–Ω–Ω—ã–π
          passed=${passed:-0}
          
          echo ""
          echo "üìä –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ HTTP-–∫–æ–¥–∞:" 
          –µ—Å–ª–∏ [ -f /tmp/xray_results/http_codes.txt ] && [ -s /tmp/xray_results/http_codes.txt ]; —Ç–æ–≥–¥–∞ 
echo " HTTP 204 (success): $(grep -c '^204$' /tmp/xray_results/http_codes.txt 2>/dev/null || echo 0)" 
            echo " HTTP 000 (–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è): $(grep -c '^000$' /tmp/xray_results/http_codes.txt 2>/dev/null || echo 0)" 
other=$(grep -cvE '^(204|000)$' /tmp/xray_results/http_codes.txt 2>/dev/null || echo 0) 
            echo "–î—Ä—É–≥–∏–µ –∫–æ–¥—ã: $other" 
            –µ—Å–ª–∏ [[ $other -gt 0 ]]; —Ç–æ–≥–¥–∞ 
              echo "–î—Ä—É–≥–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è: $(sort /tmp/xray_results/http_codes.txt | uniq -c | sort -rn | head -5)" 
—Ñ–∏ 
—Ñ–∏ 
          
echo "" 
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" 
          echo "=== –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –î–í–ò–ñ–ï–ù–ò–Ø ===" 
          echo "–í—Å–µ–≥–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ: $valid_configs" 
          echo "‚úÖ –ü—Ä–æ–π–¥–µ–Ω —Ç—Ä–∞—Ñ–∏–∫: $passed"
          echo "‚ùå –ù–µ—É–¥–∞—á–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫: $((valid_configs - passed))"
          echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
          
          if ! grep -q '^-' traff.yaml 2>/dev/null; then
            echo "‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: —Ñ–∞–π–ª traff.yaml –ø—É—Å—Ç!"
          —Ñ–∏
      - name : Speed ‚Äã‚Äãtest - select TOP 100 to clash.yaml
        –≤—ã–ø–æ–ª–Ω–∏—Ç—å : |
          set -e
          echo "–ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤ $(–¥–∞—Ç–∞)"
          
          # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–≥–æ, —á—Ç–æ traff.yaml –Ω–µ –ø—É—Å—Ç–æ–π
          if ! grep -q '^-' traff.yaml 2>/dev/null; then
            echo "‚ö†Ô∏è –§–∞–π–ª traff.yaml –ø—É—Å—Ç, —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª clash.yaml"
            echo "proxies:" > clash.yaml
            –≤—ã—Ö–æ–¥ 0
          —Ñ–∏
          
          # –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ Xray (–Ω–µ —É–¥–∞–ª–∏–ª–∏ –≤ –∫–æ–Ω—Ü–µ –®–∞–≥–∞ 3)
          –µ—Å–ª–∏ [ ! -f xray/xray ]; —Ç–æ–≥–¥–∞
            echo "‚ö†Ô∏è Xray –Ω–µ –Ω–∞–π–¥–µ–Ω, –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è..."
            wget -q https://github.com/XTLS/Xray-core/releases/latest/download/Xray-linux-64.zip
            unzip -q Xray-linux-64.zip -d xray/
            chmod +x xray/xray
          —Ñ–∏
          
          # –¢–æ—Ç –∂–µ Python-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥–∞
          echo 'import json, sys, urllib.parse' > /tmp/gen_xray_config.py
          echo 'url = sys.argv[1]' >> /tmp/gen_xray_config.py
          echo 'local_port = int(sys.argv[2])' >> /tmp/gen_xray_config.py
          echo 'try:' >> /tmp/gen_xray_config.py
          echo ' parsed = urllib.parse.urlparse(url.replace("vless://", "http://"))' >> /tmp/gen_xray_config.py
          echo ' auth, server_port = parsed.netloc.split("@", 1)' >> /tmp/gen_xray_config.py
          echo ' server, port = server_port.rsplit(":", 1)' >> /tmp/gen_xray_config.py
          echo ' uuid = urllib.parse.unquote(auth)' >> /tmp/gen_xray_config.py
          echo ' params = dict(urllib.parse.parse_qsl(parsed.query))' >> /tmp/gen_xray_config.py
          echo ' network = params.get("type", "tcp")' >> /tmp/gen_xray_config.py
          echo ' security = params.get("security", "none")' >> /tmp/gen_xray_config.py
          echo ' sni = params.get("sni", "")' >> /tmp/gen_xray_config.py
          echo ' if not sni and security in ["tls", "reality"]: sni = server' >> /tmp/gen_xray_config.py
          echo ' flow = params.get("flow", "")' >> /tmp/gen_xray_config.py
          echo ' host = params.get("host", "")' >> /tmp/gen_xray_config.py
          echo ' path = params.get("path", "")' >> /tmp/gen_xray_config.py
          echo ' pbk = params.get("pbk", "")' >> /tmp/gen_xray_config.py
          echo ' sid = params.get("sid", params.get("shortId", ""))' >> /tmp/gen_xray_config.py
          echo ' fp = params.get("fp", "chrome")' >> /tmp/gen_xray_config.py
          echo ' user = {"id": uuid, "encryption": "none"}' >> /tmp/gen_xray_config.py
          echo ' if flow: user["flow"] = flow' >> /tmp/gen_xray_config.py
          echo ' outbound_settings = {"vnext": [{"address": server, "port": int(port), "users": [user]}]}' >> /tmp/gen_xray_config.py
          echo ' stream_settings = {"network": network, "security": security}' >> /tmp/gen_xray_config.py
          echo ' if security == "tls":' >> /tmp/gen_xray_config.py
          echo ' stream_settings["tlsSettings"] = {"serverName": sni, "allowInsecure": True, "fingerprint": fp}' >> /tmp/gen_xray_config.py
          echo ' elif security == "reality":' >> /tmp/gen_xray_config.py
          echo ' reality_settings = {"serverName": sni, "allowInsecure": True, "fingerprint": fp}' >> /tmp/gen_xray_config.py
          echo ' if pbk: reality_settings["publicKey"] = pbk' >> /tmp/gen_xray_config.py
          echo ' if sid: reality_settings["shortId"] = sid' >> /tmp/gen_xray_config.py
          echo ' stream_settings["realitySettings"] = reality_settings' >> /tmp/gen_xray_config.py
          echo ' if network == "ws" and (path or host):' >> /tmp/gen_xray_config.py
          echo ' ws_settings = {}' >> /tmp/gen_xray_config.py
          echo ' if path: ws_settings["path"] = path' >> /tmp/gen_xray_config.py
          echo ' if host: ws_settings["headers"] = {"Host": host}' >> /tmp/gen_xray_config.py
          echo ' stream_settings["wsSettings"] = ws_settings' >> /tmp/gen_xray_config.py
          echo ' elif network == "grpc":' >> /tmp/gen_xray_config.py
          echo ' grpc_settings = {}' >> /tmp/gen_xray_config.py
          echo ' if params.get("serviceName"): grpc_settings["serviceName"] = params.get("serviceName")' >> /tmp/gen_xray_config.py
          echo ' stream_settings["grpcSettings"] = grpc_settings' >> /tmp/gen_xray_config.py
          echo ' config = {"log": {"loglevel": "none"}, "inbounds": [{"port": local_port, "protocol": "socks", "settings": {"auth": "noauth", "udp": True}}], "outbounds": [{"tag": "proxy", "protocol": "vless", "settings": outbound_settings, "streamSettings": stream_settings}]}' >> /tmp/gen_xray_config.py
          echo ' print(json.dumps(config, indent=2))' >> /tmp/gen_xray_config.py
          echo 'except Exception as e:' >> /tmp/gen_xray_config.py
          echo ' print(json.dumps({"error": str(e)}), file=sys.stderr)' >> /tmp/gen_xray_config.py
          echo ' sys.exit(1)' >> /tmp/gen_xray_config.py
          
          urldecode() {
            –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ="$1"
            decoded=$(echo "$data" | sed 's/%/\\x/g' | xargs -0 printf "%b" 2>/dev/null || echo "$data")
            echo "$decoded"
          }
          
          clean_uuid() {
            local raw_uuid="$1"
            —ç—Ö–æ "$raw_uuid" | sed 's/[^a-zA-Z0-9@.\-]//g'
          }
          
          clean_name() {
            —ç—Ö–æ "$1" | sed 's/[^a-zA-Z0-9.-]//g'
          }
          
          > /tmp/speed_results.txt
          mkdir -p /tmp/speed_test
          rm -f /tmp/speed_test/*
          
          –≤—Å–µ–≥–æ=0
          –∏–∑–º–µ—Ä–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ = 0
          MAX_SPEED_TEST=100
          
          while IFS= read -r line || [ -n "$line" ]; do
            [[ "$line" == "proxies:" ]] && continue
            [[ -z "$line" ]] && continue
            
            url="${line# - }"
            total=$((total + 1))
            
            [[ $measured -ge $MAX_SPEED_TEST ]] && break
            
            server_port=$(echo "$url" | sed -n 's#vless://[^@]*@\([^?#]*\).*#\1#p')
            server=$(echo "$server_port" | cut -d: -f1)
            port=$(echo "$server_port" | cut -d: -f2 | grep -E '^[0-9]+$' || true)
            
            –µ—Å–ª–∏ [ -z "$server" ] || [ -z "$port" ]; —Ç–æ–≥–¥–∞
              –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å
            —Ñ–∏
            
            # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø–æ—Ä—Ç –¥–ª—è —ç—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞
            local_port=$((20000 + total))
            
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è Xray
            config_file="/tmp/speed_test/config_${total}.json"
python3 /tmp/gen_xray_config.py "$url" "$local_port" > "$config_file" 2>/dev/null || continue 
            
            echo -n "[$total] –ò–∑–º–µ—Ä–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ $server:$port... " 
            
            # –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–µ–Ω—Ç–≥–µ–Ω 
./xray/xray -config "$config_file" >/dev/null 2>&1 & 
XRAY_PID=$! 
            
            # –ñ–∏—Ç—å –∑–∞–ø—É—Å–∫ 
for i in {1..20}; do 
if nc -z 127.0.0.1 "$local_port" 2>/dev/null; then break; fi 
              —Å–æ–Ω 0.2 
            —Å–¥–µ–ª–∞–Ω–Ω—ã–π 
            
start_time=$(date +%s%N) 
            
            # –¢–µ—Å—Ç —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–π SOCKS5 (–ù–ï –Ω–∞–ø—Ä—è–º—É—é –∫ —Å–µ—Ä–≤–µ—Ä—É!) 
http_code=$(curl -s -o /dev/null -w "%{http_code}" \ 
--socks5-hostname 127.0.0.1:"$local_port" \ 
--connect-timeout 3 --max-time 5 \ 
              "http://www.gstatic.com/generate_204" 2>/dev/null) || http_code="000"
            
            end_time=$(date +%s%N)
            
            # –û—á–∏—Å—Ç–∫–∞
            kill $XRAY_PID 2>/dev/null || true
            wait $XRAY_PID 2>/dev/null || true
            rm -f "$config_file"
            
            –µ—Å–ª–∏ [[ "$http_code" == "204" ]]; —Ç–æ–≥–¥–∞
              duration=$(( ($end_time - $start_time) / 1000000 ))
              echo "${duration}ms"
              
              uuid_encoded=$(echo "$url" | sed -n 's#vless://\([^@]*\)@.*#\1#p')
              uuid_raw=$(urldecode "$uuid_encoded")
              uuid=$(clean_uuid "$uuid_raw")
              
              query=$(echo "$url" | sed -n 's/.*?\(.*\)#.*/\1/p; s/.*?\(.*\)/\1/p')
              
              network="tcp"
              —Ö–æ—Å—Ç=""
              –ø—É—Ç—å=""
              flow=""
              –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å="–Ω–µ—Ç"
              sni=""
              
              –µ—Å–ª–∏ [ -n "$query" ]; —Ç–æ–≥–¥–∞
                while IFS='=' read -r key value; do
                  [[ -z "$key" ]] && continue
                  value=$(urldecode "$value")
                  case "$key" in
                    "type") network="$value" ;;
                    "host") host="$value" ;;
                    "path") path="$value" ;;
                    "flow") flow="$value" ;;
                    "–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å") security="$value" ;;
                    "sni") sni="$value" ;;
                  esac
                –≥–æ—Ç–æ–≤–æ < <(echo "$query" | tr '&' '\n')
              —Ñ–∏
              
              uuid_short=$(echo "$uuid" | cut -c1-8)
              raw_name="${server}-${port}-${uuid_short}"
              –∏–º—è=$(clean_name "$raw_name")
              
              {
                echo " - –∏–º—è: \"$name\""
                echo " type: vless"
                echo " server: \"$server\""
                echo "–ø–æ—Ä—Ç: $port"
                echo " uuid: \"$uuid\""
                echo " network: \"$network\""
                –µ—Å–ª–∏ [ "$security" = "tls" ] || [ "$security" = "reality" ]; —Ç–æ–≥–¥–∞
                  echo " tls: true"
                  –µ—Å–ª–∏ [ -n "$sni" ]; —Ç–æ–≥–¥–∞
                    echo " sni: \"$sni\""
                  —Ñ–∏
                –µ—â–µ
                  echo " tls: false"
                —Ñ–∏
                echo "udp: true"
                –µ—Å–ª–∏ [ -n "$flow" ]; —Ç–æ–≥–¥–∞
                  echo " flow: \"$flow\""
                —Ñ–∏
if [ "$network" = "ws" ] && [ -n "$path" ]; then 
echo " ws-opts:" 
                  echo " –ø—É—Ç—å: \"$path\"" 
                  –µ—Å–ª–∏ [ -n "$host" ]; —Ç–æ–≥–¥–∞ 
                    echo " –∑–∞–≥–æ–ª–æ–≤–∫–∏:" 
                    echo " –•–æ—Å—Ç: \"$host\"" 
—Ñ–∏ 
—Ñ–∏ 
} > /tmp/proxy_entry.txt 
              
proxy_entry=$(cat /tmp/proxy_entry.txt) 
rm -f /tmp/proxy_entry.txt 
              
echo "$duration|$proxy_entry" >> /tmp/speed_results.txt 
–∏–∑–º–µ—Ä–µ–Ω–Ω–æ–µ = $((–∏–∑–º–µ—Ä–µ–Ω–Ω–æ–µ + 1)) 
            –µ—â–µ 
              echo "FAILED (HTTP $http_code)"
—Ñ–∏ 
            
–≥–æ—Ç–æ–≤–æ < traff.yaml 
          
echo "" 
          echo "=== –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ê –°–ö–û–†–û–°–¢–ò ===" 
          echo "–ü—Ä–æ–∫—Å–∏ –≤ traff.yaml: $total" 
          echo "–ò–∑–º–µ—Ä–µ–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: $measured" 
          
echo "" 
          echo "–í—ã–±–æ—Ä 100 —Å–∞–º—ã—Ö –±—ã—Å—Ç—Ä—ã—Ö –ø—Ä–æ–∫—Å–∏..." 
echo "proxies:" > clash.yaml 
          
          –µ—Å–ª–∏ [ $measured -gt 0 ]; —Ç–æ–≥–¥–∞ 
sort -n /tmp/speed_results.txt | head -100 | while IFS='|' read -r speed entry; do 
echo "$entry" >> clash.yaml 
echo "" >> clash.yaml 
            —Å–¥–µ–ª–∞–Ω–Ω—ã–π 
            
final_count=$(grep -c '^- name:' clash.yaml 2>/dev/null) || –∏—Å—Ç–∏–Ω–Ω—ã–π 
final_count=${final_count:-0} 
            echo "‚úÖ –í—ã–±—Ä–∞–Ω—ã –¢–û–ü —Å–∞–º—ã—Ö –±—ã—Å—Ç—Ä—ã—Ö –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–æ–≤ –∏–∑ $final_count" 
          –µ—â–µ 
            echo "‚ö†Ô∏è –†–∞–±–æ—á–∏–µ –ø—Ä–æ–∫—Å–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã" 
echo "proxies:" > clash.yaml 
—Ñ–∏ 
          
all_count=$(grep -c '^-' all_proxies.yaml 2>/dev/null) || –∏—Å—Ç–∏–Ω–Ω—ã–π 
all_count=${all_count:-0} 
ping_count=$(grep -c '^-' ping.yaml 2>/dev/null) || –∏—Å—Ç–∏–Ω–Ω—ã–π 
ping_count=${ping_count:-0} 
traff_count=$(grep -c '^-' traff.yaml 2>/dev/null) || –∏—Å—Ç–∏–Ω–Ω—ã–π 
hit_count=${hit_count:-0} 
clash_count=$(grep -c '^- name:' clash.yaml 2>/dev/null) || –∏—Å—Ç–∏–Ω–Ω—ã–π 
clash_count=${clash_count:-0} 
          
echo "" 
          echo "=== –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê ===" 
echo "all_proxies.yaml: $all_count total" 
echo "ping.yaml: $ping_count after ping test" 
echo "traff.yaml: $traff_count after traffic test" 
echo "clash.yaml: $clash_count TOP 100" 
          
rm -f /tmp/speed_results.txt 
rm -rf /tmp/speed_test 
- –∏–º—è : –ü–æ–∫–∞–∑–∞—Ç—å –æ–±—Ä–∞–∑–µ—Ü 
        –≤—ã–ø–æ–ª–Ω–∏—Ç—å : | 
          echo "=== –ü–ï–†–í–´–ï 3 –ü–†–û–ö–°–ò –í CLASH.YAML ===" 
head -n 30 clash.yaml | grep -A 10 "^- name:" | head -n 30 
- –∏–º—è : –ü—Ä–∏–º–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ –∏ –¥–µ–π—Å—Ç–≤—É–π—Ç–µ 
        –≤—ã–ø–æ–ª–Ω–∏—Ç—å : | 
if git diff --quiet && git diff --staged --quiet; then 
            echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏" 
            –≤—ã—Ö–æ–¥ 0 
—Ñ–∏ 
          
git config --global user.name "github-actions[bot]" 
git config --global user.email "github-actions[bot]@users.noreply.github.com" 
          
ping_count=$(grep -c '^-' ping.yaml 2>/dev/null) || –∏—Å—Ç–∏–Ω–Ω—ã–π 
ping_count=${ping_count:-0} 
traff_count=$(grep -c '^-' traff.yaml 2>/dev/null) || –∏—Å—Ç–∏–Ω–Ω—ã–π 
hit_count=${hit_count:-0} 
clash_count=$(grep -c '^- name:' clash.yaml 2>/dev/null) || –∏—Å—Ç–∏–Ω–Ω—ã–π 
clash_count=${clash_count:-0} 
          
git add all_proxies.yaml ping.yaml traff.yaml clash.yaml 
          git commit -m "–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–∫—Å–∏ $(–¥–∞—Ç–∞) - P:${ping_count} T:${traff_count} C:${clash_count}" 
git push 
          echo "–ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –≤–Ω–µ—Å–µ–Ω—ã" 
- –∏–º—è : –û—á–∏—Å—Ç–∫–∞ 
        –≤—ã–ø–æ–ª–Ω–∏—Ç—å : | 
rm -rf /tmp/xray_results /tmp/xray_* /tmp/speed_test xray/ Xray-linux-64.zip /tmp/gen_xray_config.py 
          echo "–û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞" 

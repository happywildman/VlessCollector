      - name: Collect and Filter proxies
        run: |
          # Автоматически находим файл со ссылками, игнорируя регистр
          SOURCE_FILE=$(ls | grep -i "vlesslinks.txt" | head -n 1)
          if [ -z "$SOURCE_FILE" ]; then SOURCE_FILE="links.txt"; fi
          
          if [ ! -f "$SOURCE_FILE" ]; then
            echo "Ошибка: Файл со ссылками не найден!"
            ls -R
            exit 1
          fi

          rm -f all_proxies.txt temp_proxies.txt
          touch temp_proxies.txt
          
          echo "Читаю из файла: $SOURCE_FILE"
          while IFS= read -r url || [ -n "$url" ]; do
            [[ -z "$url" ]] && continue
            echo "Скачиваю: $url"
            curl -sL --max-time 10 "$url" >> temp_proxies.txt
            echo "" >> temp_proxies.txt
          done < "$SOURCE_FILE"
          
          # Оставляем только прокси, убираем дубликаты, лимит 20к строк
          grep -Ei "vless:|ss:|trojan:|vmess:|hy2:" temp_proxies.txt | sort -u | head -n 20000 > all_proxies.txt
          rm temp_proxies.txt
